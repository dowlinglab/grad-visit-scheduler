# Building Movement and Staggered Starts

This page documents the new movement interface in the run config (`movement:`),
which generalizes scheduling across one, two, or many buildings.

All examples on this page use the larger formulation visitor dataset:

- `examples/data_formulation_visitors.csv`
- `examples/faculty_formulation.yaml` (or building-variant catalogs derived from it)

GitHub source links for this page:

- [movement docs examples folder](https://github.com/dowlinglab/grad-visit-scheduler/tree/main/examples)
- [one/two/three building script](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/scripts/run_building_configuration_examples.py)
- [A-first/B-first comparison script](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/scripts/run_shifted_start_comparison.py)

## Movement Configuration

Add a `movement` block to your run config:

```yaml
movement:
  policy: none          # or travel_time
  phase_slot:
    BuildingA: 1
    BuildingB: 1
  travel_slots:         # only used for policy: travel_time
    BuildingA:
      BuildingA: 0
      BuildingB: 1
    BuildingB:
      BuildingA: 1
      BuildingB: 0
```

- `policy: none`: buildings are treated as close-proximity; no explicit travel-time constraints.
- `policy: travel_time`: enforces pairwise building-to-building lag constraints using `travel_slots`.
- `phase_slot`: earliest slot each building is allowed to host meetings. This enables staggered starts.

## Example Results

The following table is generated by:

```bash
python scripts/run_building_configuration_examples.py
```

| Scenario | Feasible | Objective | Assignments | Requested Assignments | Group Slots |
| --- | --- | ---: | ---: | ---: | ---: |
| One building | True | 110.9 | 30 | 30 | 13 |
| Two buildings (close) | True | 110.9 | 30 | 30 | 13 |
| Three buildings (close) | True | 110.9 | 30 | 30 | 13 |

## Supported Patterns

### 1) One building

Use a single building in `buildings:` with `policy: none`.

- Example config: [`examples/config_one_building.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_one_building.yaml)
- Example faculty catalog: [`examples/faculty_one_building.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/faculty_one_building.yaml)
- Visitor data: [`examples/data_formulation_visitors.csv`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/data_formulation_visitors.csv)

![One Building Visitor View](_static/movement_one_building_visitor.png)

### 2) Two close buildings (no travel-time constraints)

Use two buildings with `policy: none` and both phase slots set to `1`.

- Example config: [`examples/config_two_buildings_close.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_two_buildings_close.yaml)
- Faculty catalog: [`examples/faculty_formulation.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/faculty_formulation.yaml)
- Visitor data: [`examples/data_formulation_visitors.csv`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/data_formulation_visitors.csv)

![Two Buildings Close Visitor View](_static/movement_two_buildings_close_visitor.png)

### 3) Three or more close buildings (no travel-time constraints)

Use `policy: none` with one `phase_slot` entry per building.

- Example config: [`examples/config_three_buildings_close.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_three_buildings_close.yaml)
- Example faculty catalog: [`examples/faculty_three_buildings.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/faculty_three_buildings.yaml)
- Visitor data: [`examples/data_formulation_visitors.csv`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/data_formulation_visitors.csv)

![Three Buildings Close Visitor View](_static/movement_three_buildings_close_visitor.png)

## Staggered Starts (A First vs B First)

Staggered starts are now represented through `phase_slot`.

- Building A first:

```yaml
movement:
  policy: none
  phase_slot:
    BuildingA: 1
    BuildingB: 2
```

- Building B first:

```yaml
movement:
  policy: none
  phase_slot:
    BuildingA: 2
    BuildingB: 1
```

Repository configs:

- [`examples/config_shifted_a_first.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_shifted_a_first.yaml)
- [`examples/config_shifted_b_first.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_shifted_b_first.yaml)

Comparison runner:

```bash
python scripts/run_shifted_start_comparison.py
```

This script solves both scenarios and prints a side-by-side table of objective
value and key schedule metrics, then writes both visitor and faculty plots.

The script uses:

- [`examples/faculty_formulation.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/faculty_formulation.yaml)
- [`examples/data_formulation_visitors.csv`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/data_formulation_visitors.csv)
- [`examples/config_shifted_a_first.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_shifted_a_first.yaml)
- [`examples/config_shifted_b_first.yaml`](https://github.com/dowlinglab/grad-visit-scheduler/blob/main/examples/config_shifted_b_first.yaml)

Results:

| Scenario | Feasible | Objective | Meetings | Requested Meetings | Group Meetings |
| --- | --- | ---: | ---: | ---: | ---: |
| Building A first | True | 101.8 | 26 | 26 | 11 |
| Building B first | True | 94.9 | 24 | 23 | 9 |

Visitor-view plots:

![Shifted A First Visitor View](_static/movement_shifted_a_first_visitor.png)

![Shifted B First Visitor View](_static/movement_shifted_b_first_visitor.png)

Faculty-view plots:

![Shifted A First Faculty View](_static/movement_shifted_a_first_faculty.png)

![Shifted B First Faculty View](_static/movement_shifted_b_first_faculty.png)

## Executable Comparison Across 1/2/3 Buildings

Run all close-proximity building-configuration examples (one, two, and three buildings)
on the large formulation dataset:

```bash
python scripts/run_building_configuration_examples.py
```

This prints a side-by-side summary table with objective and assignment metrics.

## Legacy Mode Compatibility

`mode=Mode.BUILDING_A_FIRST`, `mode=Mode.BUILDING_B_FIRST`, and
`mode=Mode.NO_OFFSET` remain available with `FutureWarning`, but `movement` is
the preferred interface for new code.

## Legacy Mode Migration Guide

Equivalent `movement` mappings:

- `Mode.BUILDING_A_FIRST`:

```yaml
movement:
  policy: none
  phase_slot:
    BuildingA: 1
    BuildingB: 2
```

- `Mode.BUILDING_B_FIRST`:

```yaml
movement:
  policy: none
  phase_slot:
    BuildingA: 2
    BuildingB: 1
```

- `Mode.NO_OFFSET`:

```yaml
movement:
  policy: travel_time
  phase_slot:
    BuildingA: 1
    BuildingB: 1
  travel_slots:
    BuildingA:
      BuildingA: 0
      BuildingB: 1
    BuildingB:
      BuildingA: 1
      BuildingB: 0
```

Break-behavior nuance:

- Legacy `Mode.NO_OFFSET` implicitly enables break constraints by default.
- Movement-only configs do **not** implicitly enable break constraints.
- To match legacy `NO_OFFSET` break behavior, set `enforce_breaks=True` in
  `schedule_visitors(...)` / `schedule_visitors_top_n(...)`.
